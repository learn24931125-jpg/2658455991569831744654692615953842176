<H1>æ™ºæ…§æ—…éŠå°è¦½</H1>
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å°ç£æ™ºæ…§æ—…éŠåŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_MAPS_API_KEY&libraries=places"></script>
    <style>
        #map { height: 500px; width: 100%; border-radius: 0.75rem; }
        .loading { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-900">

    <header class="bg-gradient-to-r from-indigo-600 to-blue-500 text-white py-10 px-4 shadow-md">
        <div class="max-w-6xl mx-auto text-center">
            <h1 class="text-4xl font-black mb-2 tracking-tight"><i class="fa-solid fa-plane-up mr-3"></i>AI æ™ºæ…§æ—…éŠè¦åŠƒç³»çµ±</h1>
            <p class="opacity-80">è‡ªå‹•ç”Ÿæˆè¡Œç¨‹ä¸¦åœ¨ Google Maps ä¸Šæ¨™è¨˜æ™¯é»</p>
        </div>
    </header>

    <main class="max-w-6xl mx-auto p-4 md:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <aside class="lg:col-span-4 space-y-6">
            <section class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <h2 class="text-lg font-bold mb-4 flex items-center text-indigo-600">
                    <i class="fa-solid fa-gear mr-2"></i> ç³»çµ±è¨­å®š
                </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold mb-1">Gemini API Key</label>
                        <input type="password" id="geminiKey" placeholder="è¼¸å…¥ API é‡‘é‘°" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-1">ç›®çš„åœ°</label>
                        <input type="text" id="destination" placeholder="ä¾‹å¦‚ï¼šå°å—å¸‚" class="w-full p-2 border rounded-lg">
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-semibold mb-1">å¤©æ•¸</label>
                            <input type="number" id="days" value="2" min="1" class="w-full p-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-1">é ç®—</label>
                            <select id="budget" class="w-full p-2 border rounded-lg">
                                <option>ç¶“æ¿Ÿ</option>
                                <option selected>ä¸€èˆ¬</option>
                                <option>å¥¢è¯</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="startPlanning()" id="btnGenerate" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl transition shadow-lg">
                        ç”Ÿæˆè¡Œç¨‹
                    </button>
                </div>
            </section>

            <section id="itineraryList" class="space-y-4 overflow-y-auto max-h-[500px]">
                </section>
        </aside>

        <div class="lg:col-span-8 space-y-4">
            <div id="map" class="shadow-inner border-2 border-white bg-slate-200 flex items-center justify-center">
                <span class="text-slate-400">è«‹åœ¨åœ°åœ– API è¼‰å…¥å¾Œé–‹å§‹è¦åŠƒ</span>
            </div>
            <div id="statusUpdate" class="p-4 bg-white rounded-xl text-sm border border-slate-200 hidden">
                <i class="fa-solid fa-circle-notch fa-spin mr-2 text-indigo-500"></i>
                <span id="statusText">æ­£åœ¨è¯ç¹« AI è§£ææ•¸æ“š...</span>
            </div>
        </div>
    </main>

    <script>
        let map;
        let markers = [];

        // åˆå§‹åŒ–åœ°åœ–
        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 23.6, lng: 121 },
                zoom: 7,
                styles: [{ featureType: "poi", elementType: "labels", stylers: [{ visibility: "off" }] }]
            });
        }
        window.onload = initMap;

        async function startPlanning() {
            const apiKey = document.getElementById('geminiKey').value;
            const dest = document.getElementById('destination').value;
            const days = document.getElementById('days').value;
            const budget = document.getElementById('budget').value;

            if (!apiKey || !dest) return alert("è«‹å¡«å¯«é‡‘é‘°èˆ‡ç›®çš„åœ°");

            // UI ç‹€æ…‹åˆ‡æ›
            const btn = document.getElementById('btnGenerate');
            btn.disabled = true;
            btn.innerText = "è¦åŠƒä¸­...";
            document.getElementById('statusUpdate').classList.remove('hidden');

            const prompt = `ä½ æ˜¯ä¸€ä½æ—…éŠå°ˆå®¶ï¼Œè«‹è¦åŠƒ ${dest} ${days} å¤©æ—…éŠè¡Œç¨‹ã€‚
            å¿…é ˆåš´æ ¼ä»¥ JSON æ ¼å¼å›å‚³é™£åˆ—ï¼Œä¸å«ä»»ä½• Markdown æ¨™è¨˜æˆ–å¼•è¨€ã€‚
            æ ¼å¼å¦‚ä¸‹ï¼š[{"day": 1, "locations": [{"name": "åœ°é»åç¨±", "desc": "ç°¡ä»‹"}]}]`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                const data = await response.json();
                let rawText = data.candidates[0].content.parts[0].text;
                
                // æ¸…ç†å¯èƒ½çš„ Markdown æ¨™ç±¤
                const cleanJson = rawText.replace(/```json|```/g, "").trim();
                const itinerary = JSON.parse(cleanJson);

                renderItinerary(itinerary);
                markLocationsOnMap(itinerary);

            } catch (err) {
                console.error(err);
                alert("ç”Ÿæˆå¤±æ•—ï¼Œè«‹æª¢æŸ¥ API Key æˆ–è¼¸å…¥æ ¼å¼");
            } finally {
                btn.disabled = false;
                btn.innerText = "ç”Ÿæˆè¡Œç¨‹";
                document.getElementById('statusUpdate').classList.add('hidden');
            }
        }

        function renderItinerary(data) {
            const list = document.getElementById('itineraryList');
            list.innerHTML = data.map(d => `
                <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-indigo-500">
                    <h3 class="font-bold text-lg mb-2 text-indigo-700">ç¬¬ ${d.day} å¤©</h3>
                    ${d.locations.map(loc => `<p class="text-sm mb-1">ğŸ“ <b>${loc.name}</b>: ${loc.desc}</p>`).join('')}
                </div>
            `).join('');
        }

        function markLocationsOnMap(data) {
            // æ¸…é™¤èˆŠæ¨™è¨˜
            markers.forEach(m => m.setMap(null));
            markers = [];
            const bounds = new google.maps.LatLngBounds();
            const service = new google.maps.places.PlacesService(map);

            data.forEach(day => {
                day.locations.forEach(spot => {
                    service.findPlaceFromQuery({
                        query: spot.name,
                        fields: ['name', 'geometry']
                    }, (results, status) => {
                        if (status === google.maps.places.PlacesServiceStatus.OK && results[0]) {
                            const marker = new google.maps.Marker({
                                map: map,
                                position: results[0].geometry.location,
                                title: spot.name,
                                animation: google.maps.Animation.DROP
                            });
                            markers.push(marker);
                            bounds.extend(results[0].geometry.location);
                            map.fitBounds(bounds);
                        }
                    });
                });
            });
        }
    </script>
</body>
</html>
