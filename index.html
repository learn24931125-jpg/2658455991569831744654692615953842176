<H1>智慧旅遊導覽</H1>
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>AI 台灣旅遊規畫系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .prose h2 { font-size: 1.5rem; font-weight: bold; margin-top: 1.5rem; color: #2563eb; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem; }
        .prose ul { list-style-type: disc; margin-left: 1.5rem; }
        .prose li { margin-bottom: 0.5rem; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">

    <div class="max-w-3xl mx-auto py-12 px-4">
        <h1 class="text-3xl font-bold text-center text-slate-800 mb-8">
            <i class="fas fa-plane-departure text-blue-500 mr-2"></i>AI 台灣智慧行程規畫
        </h1>

        <div class="bg-white rounded-2xl shadow-sm p-6 mb-8">
            <div class="space-y-4">
                <textarea id="userInput" rows="3" 
                    class="w-full border border-slate-200 rounded-xl p-4 focus:ring-2 focus:ring-blue-500 outline-none transition"
                    placeholder="例如：我想去台中兩天一夜，喜歡文青咖啡店和夜市，預算中等。"></textarea>
                
                <button onclick="startPlanning()" id="submitBtn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl transition flex items-center justify-center">
                    <span>開始 AI 規畫</span>
                </button>
            </div>
        </div>

        <div id="loading" class="hidden text-center py-10">
            <div class="animate-spin text-blue-500 text-3xl mb-2"><i class="fas fa-circle-notch"></i></div>
            <p class="text-slate-500">AI 導遊正在為您查詢最佳路徑...</p>
        </div>

        <div id="resultBox" class="bg-white rounded-2xl shadow-sm p-8 hidden">
            <div id="resultContent" class="prose prose-slate max-w-none"></div>
        </div>
    </div>

    <script>
        async function startPlanning() {
            const prompt = document.getElementById('userInput').value;
            const btn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const resultBox = document.getElementById('resultBox');
            const resultContent = document.getElementById('resultContent');

            if (!prompt) return alert("請輸入您的旅遊想法！");

            // UI 狀態切換
            btn.disabled = true;
            btn.classList.add('opacity-50');
            loading.classList.remove('hidden');
            resultBox.classList.add('hidden');

            try {
                const response = await fetch('http://localhost:3000/api/plan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: prompt })
                });

                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;

                // 渲染 Markdown
                resultContent.innerHTML = marked.parse(text);
                resultBox.classList.remove('hidden');
            } catch (error) {
                alert("伺服器連線失敗，請確保後端已啟動。");
            } finally {
                btn.disabled = false;
                btn.classList.remove('opacity-50');
                loading.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
