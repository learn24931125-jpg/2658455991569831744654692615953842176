<H1>æ™ºæ…§æ—…éŠå°è¦½</H1>
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ™ºæ…§æ—…éŠå°è¦½ç³»çµ± - å°ç£ (Neumorphism)</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        /* ========================================= */
        /* CSS æ¨£å¼ (å„ªåŒ–ç‰ˆ Neumorphism) */
        /* ========================================= */
        :root {
            /* ä¸»é¡Œè‰²è®Šæ•¸ */
            --main-color: #e0e5ec; 
            --light-color: #ffffff;
            --dark-color: #a3b1c6; 
            --primary-color: #4CAF50; /* ç¶ è‰² */
            --accent-color: #007bff; /* è—è‰² */
            --error-color: #dc3545; /* ç´…è‰² */
            --success-color: #28a745; /* æˆåŠŸç¶  */
            --border-radius: 12px;

            /* Neumorphism é™°å½±åƒæ•¸ */
            --shadow-out: 7px 7px 15px var(--dark-color), -7px -7px 15px var(--light-color);
            --shadow-in: inset 5px 5px 10px var(--dark-color), inset -5px -5px 10px var(--light-color);
            --shadow-pressed: inset 3px 3px 7px var(--dark-color), inset -3px -3px 7px var(--light-color);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Segoe UI', Tahoma, sans-serif;
        }

        body {
            background-color: var(--main-color);
            padding: 20px;
        }

        .container {
            display: grid;
            grid-template-columns: 280px 1fr; 
            grid-template-rows: auto 1fr; 
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* --- Neumorphism åŸºç¤æ¨£å¼ --- */

        .neumorphism-panel, .neumorphism-card {
            background: var(--main-color);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-out); 
            transition: all 0.3s ease;
        }

        .header-panel {
            grid-column: 1 / -1; 
            text-align: center;
            padding: 30px 20px;
        }

        .sidebar {
            grid-row: 2 / 3;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* è¼¸å…¥æ¡†å’Œé¸æ“‡æ¡† */
        .neumorphism-input, .neumorphism-select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: none;
            background: var(--main-color);
            border-radius: 8px;
            box-shadow: var(--shadow-in); 
            color: #333;
        }
        
        .neumorphism-input:focus, .neumorphism-select:focus {
            outline: none;
            box-shadow: inset 2px 2px 5px var(--dark-color); 
        }

        /* é¸å–®é …ç›® */
        .menu-list { list-style: none; padding: 0; }
        .neumorphism-item {
            display: block;
            text-decoration: none;
            color: #333;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: var(--shadow-out); 
            transition: all 0.2s ease;
        }

        .neumorphism-item:hover:not(.active):not(.disabled) {
            box-shadow: var(--shadow-pressed); 
            color: var(--accent-color);
        }

        .neumorphism-item.active {
            box-shadow: var(--shadow-in); 
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .neumorphism-item.disabled {
            color: #999;
            cursor: default;
            box-shadow: none;
            background: #f0f4f8;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .neumorphism-button {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: var(--shadow-out); 
            transition: all 0.2s ease-in-out;
            margin-top: 10px;
        }

        .neumorphism-button:active {
            box-shadow: var(--shadow-in); 
        }

        .primary-button { color: white; background-color: var(--primary-color); }
        .accent-button { color: white; background-color: var(--accent-color); }
        .small-button { padding: 8px 12px; font-size: 0.9em; margin-right: 5px; }

        /* --- ä¸»è¦å…§å®¹å€ --- */

        .main-content {
            grid-column: 2 / 3;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .cards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .attraction-card {
            width: calc(50% - 10px); 
            display: flex;
            overflow: hidden;
            display: none; /* åˆå§‹ç‹€æ…‹ï¼Œç”± JS æ§åˆ¶é¡¯ç¤º */
            cursor: pointer;
        }
        
        .card-image-placeholder {
            width: 40%;
            min-height: 180px;
            background-color: #d8dee8;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-style: italic;
            color: #666;
            border-radius: var(--border-radius) 0 0 var(--border-radius);
            text-align: center;
            overflow: hidden;
        }

        .card-image-placeholder img { width: 100%; height: 100%; object-fit: cover; }
        .card-content { width: 60%; padding: 15px; }
        .description { margin: 10px 0 15px; color: #555; font-size: 0.9em; }

        /* è·¯ç·šçµæœé¡¯ç¤ºå€å¡Šæ¨£å¼ (ä¸­å¤®é¡¯ç¤º) */
        #route-result-section {
            display: none; /* åˆå§‹éš±è—ï¼Œç”± JS æ§åˆ¶é¡¯ç¤º */
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-out);
            background-color: var(--main-color);
        }

        .route-message {
            margin-top: 15px;
            padding: 15px;
            font-size: 0.95em;
            border-radius: 8px;
            background: #f0f4f8;
            border: 1px solid #d8dee8;
        }

        .route-message h4 {
            color: var(--success-color);
            margin-bottom: 10px;
        }

        pre { 
            white-space: pre-wrap; 
            font-family: monospace; 
            line-height: 1.6;
            padding: 10px;
            background: #e0e5ec;
            border-radius: 6px;
            border: 1px solid var(--dark-color);
        }
        
        /* åœ°åœ–å±•ç¤ºå€ */
        .map-placeholder {
            width: 100%;
            min-height: 400px;
            background-color: #d8dee8;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #444;
            box-shadow: var(--shadow-in); 
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="neumorphism-panel header-panel">
            <h1>ğŸ‡¹ğŸ‡¼ AIæ™ºæ…§æ—…éŠå°è¦½ç³»çµ±</h1>
            <p>é€é Gemini AI è¦åŠƒæ‚¨çš„å°ç£ä¹‹æ—…ï¼Œæ¢ç´¢ç²¾å½©æ™¯é»ã€‚</p>
        </header>

        <section class="api-settings neumorphism-panel">
            <h2>âš™ï¸ API è¨­å®šå€</h2>
            <div class="input-group">
                <label for="gemini-key">Gemini API Key:</label>
                <input type="password" id="gemini-key" placeholder="è¼¸å…¥æ‚¨çš„API Key" class="neumorphism-input">
                <p id="api-status" style="font-size: 0.9em; margin-top: 5px;"></p>
            </div>
            <button id="verify-api-btn" class="neumorphism-button primary-button">é©—è­‰ä¸¦ä¿å­˜è¨­å®š</button>
        </section>

        <nav class="sidebar neumorphism-panel">
            <h2>ğŸ—ºï¸ è·¯ç·šè¦åŠƒèˆ‡æ™¯é»</h2>
            
            <ul class="menu-list" id="category-menu">
                <li><a href="#" class="neumorphism-item active" data-action="filter-all">ğŸ‡¹ğŸ‡¼ æ‰€æœ‰æ™¯é»</a></li>
                <li><a href="#" class="neumorphism-item" data-action="filter-nature">ğŸï¸ è‡ªç„¶é¢¨å…‰</a></li>
                <li><a href="#" class="neumorphism-item" data-action="filter-history">ğŸ›ï¸ æ­·å²æ–‡åŒ–</a></li>
            </ul>

            <hr style="border-top: 1px solid #c0c0c0; margin: 15px 0;">

            <div class="route-overview">
                <h3>ğŸ“… AI è¡Œç¨‹æ¦‚è¦½</h3>
                <ul id="itinerary-days-menu" class="menu-list">
                    <li><a href="#" class="neumorphism-item disabled">é»æ“Šã€Œç”Ÿæˆå„ªåŒ–è·¯ç·šã€</a></li>
                </ul>
            </div>

            <div class="route-planning">
                <h3>AI è·¯ç·šç”Ÿæˆ</h3>
                
                <label for="start-location">èµ·å§‹åœ°ï¼š</label>
                <input type="text" id="start-location" placeholder="e.g., å°åŒ—è»Šç«™" class="neumorphism-input">

                <label for="interest-tags">æ—…éŠåå¥½ (Tag)ï¼š</label>
                <input type="text" id="interest-tags" placeholder="e.g., è‡ªç„¶,ç¾é£Ÿ" class="neumorphism-input">

                <label for="duration-days">å¤©æ•¸ï¼š</label>
                <select id="duration-days" class="neumorphism-select">
                    <option value="1">1å¤©</option>
                    <option value="2">2å¤©</option>
                    <option value="3" selected>3å¤©</option>
                    <option value="5">5å¤©</option>
                </select>
                
                <label for="must-visit">å¿…è¨ªæ™¯é» (Ctrl/Cmd+Clickå¡ç‰‡)</label>
                <input type="text" id="must-visit" placeholder="e.g., 101,æ—¥æœˆæ½­" class="neumorphism-input">

                <button id="generate-route-btn" class="neumorphism-button accent-button">ğŸ”¥ ç”Ÿæˆå„ªåŒ–è·¯ç·š</button>
            </div>
        </nav>

        <main class="main-content">
            <section id="route-result-section" class="neumorphism-panel">
                <h2>ğŸ“‹ è·¯ç·šè¦åŠƒçµæœ</h2>
                <div id="route-result-content" class="route-message" style="display:none;">
                    </div>
            </section>
            
            <section class="attraction-cards">
                <h2>ğŸŒŸ ç²¾é¸æ™¯é»å¡ç‰‡</h2>
                <p style="font-size: 0.9em; color: #555; margin-bottom: 20px;">
                    ğŸ’¡ **æç¤º:** æŒ‰ä½ **Ctrl** (æˆ– **Cmd**) éµé»æ“Šå¡ç‰‡ï¼Œå¯å°‡å…¶è¨­ç‚ºå¿…è¨ªç›®çš„åœ°ã€‚
                </p>
                <div id="cards-container" class="cards-container">
                    </div>
            </section>

            <section id="map-display" class="map-display neumorphism-panel">
                <h2>ğŸ“ åœ°åœ–å±•ç¤ºå€</h2>
                <div id="map-placeholder" class="map-placeholder">
                    [åœ°åœ–æ¨¡æ“¬ç•«é¢ï¼šé¡¯ç¤ºè·¯ç·šå’Œæ™¯é»æ¨™è¨˜]
                </div>
            </section>
        </main>
    </div>

    <script>
        /* ========================================= */
        /* JavaScript äº’å‹•é‚è¼¯ (æœ€çµ‚æ•´åˆç‰ˆ) */
        /* ========================================= */

        // --- æ¨¡æ“¬è³‡æ–™èˆ‡å…¨åŸŸè®Šæ•¸ ---
        const taiwanAttractions = [
            { id: 'sunmoon', name: 'æ—¥æœˆæ½­', description: 'è‡ºç£æœ€å¤§çš„å¤©ç„¶æ¹–æ³Šï¼Œæ¹–å…‰å±±è‰²ï¼Œé¢¨æ™¯ç§€éº—ã€‚æ¯å¹´å¸å¼•å¤§é‡éŠå®¢é€ è¨ªï¼Œæ˜¯åœ‹éš›çŸ¥åçš„è§€å…‰å‹åœ°ã€‚', coordinates: 'N 23.8966, E 120.9167', coord_val: { x: 10, y: 15 }, score: 95, tags: ['è‡ªç„¶', 'æ¹–æ™¯', 'ä¼‘é–’'], image: 'images/sunmoon_default.jpg' },
            { id: 'taipei101', name: 'å°åŒ—101', description: 'æ›¾ç‚ºä¸–ç•Œç¬¬ä¸€é«˜æ¨“ï¼Œæ˜¯å°åŒ—å¸‚é‡è¦çš„åœ°æ¨™ã€‚é ‚æ¨“è§€æ™¯å°å¯ä¿¯ç°å¤§å°åŒ—éƒ½æœƒå€çš„å£¯éº—æ™¯è‰²ã€‚', coordinates: 'N 25.0330, E 121.5654', coord_val: { x: 5, y: 5 }, score: 98, tags: ['åŸå¸‚', 'åœ°æ¨™', 'è³¼ç‰©'], image: 'images/taipei101_default.jpg' },
            { id: 'taroko', name: 'å¤ªé­¯é–£åœ‹å®¶å…¬åœ’', description: 'ä»¥é›„å‰å£¯éº—çš„å³½è°·æ™¯è§€èåã€‚ç«‹éœ§æºªåˆ‡å‰²è€Œæˆçš„Vå½¢å³½è°·ï¼Œæ˜¯ä¸–ç•Œç´šçš„è‡ªç„¶å¥‡è§€ã€‚', coordinates: 'N 24.1667, E 121.5000', coord_val: { x: 30, y: 25 }, score: 92, tags: ['è‡ªç„¶', 'å³½è°·', 'å¥è¡Œ'], image: 'images/taroko_default.jpg' },
            { id: 'ali', name: 'é˜¿é‡Œå±±', description: 'äº”å¥‡ï¼ˆæ—¥å‡ºã€é›²æµ·ã€æ™šéœã€æ£®æ—ã€éµé“ï¼‰èåä¸­å¤–ã€‚', coordinates: 'N 23.5152, E 120.8123', coord_val: { x: 15, y: 35 }, score: 90, tags: ['è‡ªç„¶', 'æ—¥å‡º', 'æ£®æ—'], image: 'images/ali_default.jpg' },
            { id: 'tainan_old', name: 'å®‰å¹³å¤å ¡', description: 'è‡ºç£æœ€å¤è€çš„åŸå ¡ä¹‹ä¸€ï¼Œè¦‹è­‰äº†è‡ºç£æ­·å²çš„è®Šé·ã€‚', coordinates: 'N 23.0016, E 120.1656', coord_val: { x: 25, y: 10 }, score: 88, tags: ['æ­·å²', 'æ–‡åŒ–', 'å¤è¹Ÿ'], image: 'images/tainan_default.jpg' },
            { id: 'kaohsiung_harbor', name: 'é«˜é›„æ¸¯', description: 'è‡ºç£æœ€å¤§çš„æµ·æ¸¯ï¼Œå¤œæ™šçš„ç‡ˆå…‰æ™¯è‰²éå¸¸è¿·äººã€‚', coordinates: 'N 22.6167, E 120.2833', coord_val: { x: 20, y: 40 }, score: 85, tags: ['åŸå¸‚', 'æµ·æ¸¯', 'å¤œæ™¯'], image: 'images/kaohsiung_default.jpg' }
        ];
        let currentOptimizedRoute = null; 
        
        // --- è¼”åŠ©å‡½æ•¸ ---

        function getDistance(p1, p2) {
            // æ¨¡æ“¬æ­å¹¾é‡Œå¾—è·é›¢
            return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
        }

        function createAttractionCard(attraction) {
            const imgSrc = attraction.image.includes('default') 
                ? `[AI ç”Ÿæˆåœ–ç‰‡é è¦½å€]` 
                : `<img src="${attraction.image}" alt="${attraction.name}">`;
            
            return `
                <div class="attraction-card neumorphism-card" data-id="${attraction.id}">
                    <div class="card-image-placeholder" id="img-placeholder-${attraction.id}">${imgSrc}</div>
                    <div class="card-content">
                        <h3 class="card-title">${attraction.name}</h3>
                        <p class="description card-description-${attraction.id}">${attraction.description.substring(0, 20)}...</p>
                        <div class="card-details card-details-${attraction.id}" style="display:none; margin-bottom: 10px;">
                            <p><strong>åº§æ¨™:</strong> <span class="card-coord">${attraction.coordinates}</span></p>
                        </div>
                        <button class="neumorphism-button small-button toggle-details-btn" data-action="toggle-details" data-id="${attraction.id}">
                            æŸ¥çœ‹è©³æƒ…
                        </button>
                        <button class="neumorphism-button small-button generate-image-btn" data-action="generate-image" data-name="${attraction.name}">
                            æ¨¡æ“¬ AI ç”Ÿæˆæ–°åœ–
                        </button>
                    </div>
                </div>
            `;
        }
        
        function loadAttractionCards() {
            document.getElementById('cards-container').innerHTML = taiwanAttractions.map(createAttractionCard).join('');
            filterCardsByDay(0); 
        }

        // --- æ ¸å¿ƒäº’å‹•å‡½æ•¸ ---

        function handleApiVerification() {
            const keyInput = document.getElementById('gemini-key');
            const statusText = document.getElementById('api-status');
            const key = keyInput.value.trim();

            if (key.length >= 15 && key.startsWith('AIZA')) { 
                statusText.innerHTML = 'âœ… API Key é©—è­‰æˆåŠŸï¼å·²ä¿å­˜ã€‚';
                statusText.style.color = 'var(--success-color)';
                localStorage.setItem('geminiApiKey', key);
            } else {
                statusText.innerHTML = 'âŒ è«‹è¼¸å…¥æœ‰æ•ˆçš„ Gemini API Keyã€‚ (æ¨¡æ“¬æ ¼å¼: è‡³å°‘15å€‹å­—ç¬¦ä¸”ä»¥ AIZA é–‹é ­)';
                statusText.style.color = 'var(--error-color)';
                localStorage.removeItem('geminiApiKey'); 
            }
        }
        
        function toggleDetails(cardId) {
            const card = taiwanAttractions.find(a => a.id === cardId);
            const detailsDiv = document.querySelector(`.card-details-${cardId}`);
            const descriptionP = document.querySelector(`.card-description-${cardId}`);
            const toggleBtn = document.querySelector(`.toggle-details-btn[data-id="${cardId}"]`);

            const isExpanded = detailsDiv.style.display === 'block';

            if (!isExpanded) {
                detailsDiv.style.display = 'block';
                descriptionP.innerHTML = card.description;
                toggleBtn.textContent = 'éš±è—è©³æƒ…';
                updateMapDisplaySingle(card);
            } else {
                detailsDiv.style.display = 'none';
                descriptionP.innerHTML = card.description.substring(0, 20) + '...';
                toggleBtn.textContent = 'æŸ¥çœ‹è©³æƒ…';

                const activeDayBtn = document.querySelector('#itinerary
