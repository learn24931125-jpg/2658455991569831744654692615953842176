<H1>æ™ºæ…§æ—…éŠå°è¦½</H1>
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ™ºæ…§æ—…éŠå°è¦½ç³»çµ± - å°ç£</title>
    <link rel="stylesheet" href="style.css">
    
    <script defer
        src="https://maps.googleapis.com/maps/api/js?key=YOUR_MAP_API_KEY&callback=initMap">
    </script>
</head>
<body>

    <div class="container">

        <header class="header">
            <h1>ğŸ‡¹ğŸ‡¼ AI æ™ºæ…§æ—…éŠå°è¦½ç³»çµ±</h1>
            <p>è·¯ç·šè¦åŠƒã€æ™¯é»ä»‹ç´¹èˆ‡åœ–ç‰‡ç”Ÿæˆ</p>
        </header>

        <section class="api-settings neumorphic-card">
            <h3>âš™ï¸ API & è¨­å®š</h3>
            <div class="setting-group">
                <label for="ai-api-key">AI Key:</label>
                <input type="text" id="ai-api-key" placeholder="è¼¸å…¥ AI æœå‹™é‡‘é‘° (ex: Gemini)">
            </div>
            <button class="neumorphic-button">å„²å­˜è¨­å®š</button>
        </section>

        <main class="main-content">
            
            <div class="left-panel">
                
                <nav class="attraction-menu neumorphic-card">
                    <h3>ğŸ“‚ æ™¯é»åˆ†é¡</h3>
                    <div class="menu-buttons">
                        <button class="neumorphic-button active" data-filter="all">å…¨éƒ¨</button>
                        <button class="neumorphic-button" data-filter="åŒ—éƒ¨">åŒ—éƒ¨</button>
                        <button class="neumorphic-button" data-filter="ä¸­éƒ¨">ä¸­éƒ¨</button>
                        <button class="neumorphic-button" data-filter="å—éƒ¨">å—éƒ¨</button>
                        <button class="neumorphic-button" data-filter="æ±éƒ¨">æ±éƒ¨</button>
                    </div>
                    <div class="search-box">
                        <input type="text" id="attraction-search" placeholder="ğŸ” æœå°‹æ™¯é»..." class="neumorphic-input">
                    </div>
                </nav>

                <section class="attraction-cards">
                    <h2>âœ¨ æ¨è–¦æ™¯é» (é»é¸æŒ‰éˆ•è¨­å®šèµ·è¨–é»)</h2>
                    
                    <div class="card neumorphic-card" data-region="åŒ—éƒ¨" data-name="å°åŒ— 101">
                        <div class="card-image-placeholder">
                            
                        </div>
                        <h3>å°åŒ— 101</h3>
                        <p>ğŸ™ï¸ å°ç£åœ°æ¨™ï¼Œä¸–ç•Œç´šè§€å…‰æ™¯é»ã€‚</p>
                        <div class="card-actions">
                            <button class="neumorphic-button-small" data-type="start">è¨­ç‚ºå•Ÿç¨‹åœ°</button>
                            <button class="neumorphic-button-small" data-type="end">è¨­ç‚ºç›®çš„åœ°</button>
                            <button class="neumorphic-button-small" data-type="details">çœ‹è©³æƒ…/ç”Ÿæˆåœ–ç‰‡</button>
                        </div>
                    </div>

                    <div class="card neumorphic-card" data-region="ä¸­éƒ¨" data-name="æ—¥æœˆæ½­">
                        <div class="card-image-placeholder">
                            
                        </div>
                        <h3>æ—¥æœˆæ½­</h3>
                        <p>ğŸï¸ å°ç£æœ€ç¾çš„é«˜å±±æ¹–æ³Šã€‚</p>
                        <div class="card-actions">
                            <button class="neumorphic-button-small" data-type="start">è¨­ç‚ºå•Ÿç¨‹åœ°</button>
                            <button class="neumorphic-button-small" data-type="end">è¨­ç‚ºç›®çš„åœ°</button>
                            <button class="neumorphic-button-small" data-type="details">çœ‹è©³æƒ…/ç”Ÿæˆåœ–ç‰‡</button>
                        </div>
                    </div>
                    
                    <div class="card neumorphic-card" data-region="å—éƒ¨" data-name="é˜¿é‡Œå±±">
                        <div class="card-image-placeholder">
                            
                        </div>
                        <h3>é˜¿é‡Œå±±</h3>
                        <p>ğŸŒ² å£¯éº—çš„æ—¥å‡ºã€é›²æµ·èˆ‡éµè·¯ã€‚</p>
                        <div class="card-actions">
                            <button class="neumorphic-button-small" data-type="start">è¨­ç‚ºå•Ÿç¨‹åœ°</button>
                            <button class="neumorphic-button-small" data-type="end">è¨­ç‚ºç›®çš„åœ°</button>
                            <button class="neumorphic-button-small" data-type="details">çœ‹è©³æƒ…/ç”Ÿæˆåœ–ç‰‡</button>
                        </div>
                    </div>
                    
                    <div class="card neumorphic-card" data-region="æ±éƒ¨" data-name="å¤ªé­¯é–£">
                        <div class="card-image-placeholder">
                            
                        </div>
                        <h3>å¤ªé­¯é–£</h3>
                        <p>ğŸï¸ é¬¼æ–§ç¥å·¥çš„å¤§ç†çŸ³å³½è°·ã€‚</p>
                        <div class="card-actions">
                            <button class="neumorphic-button-small" data-type="start">è¨­ç‚ºå•Ÿç¨‹åœ°</button>
                            <button class="neumorphic-button-small" data-type="end">è¨­ç‚ºç›®çš„åœ°</button>
                            <button class="neumorphic-button-small" data-type="details">çœ‹è©³æƒ…/ç”Ÿæˆåœ–ç‰‡</button>
                        </div>
                    </div>
                    

                </section>

            </div>

            <div class="right-panel">
                <h2>ğŸ—ºï¸ è·¯ç·šèˆ‡åœ°åœ–å±•ç¤º</h2>
                <div id="map-container" class="neumorphic-map">
                    <p>åœ°åœ–å°‡åœ¨æ­¤é¡¯ç¤ºè¦åŠƒè·¯ç·š</p>
                </div>
                
                <div class="route-summary neumorphic-card">
                    <h3>ğŸš— è¦åŠƒçµæœ</h3>
                    <p><strong>èµ·é»:</strong> <span id="start-point">æœªè¨­å®š</span></p>
                    <p><strong>çµ‚é»:</strong> <span id="end-point">æœªè¨­å®š</span></p>
                    <button class="neumorphic-button calculate-route">é–‹å§‹è¦åŠƒè·¯ç·š</button>
                </div>
            </div>

        </main>

    </div>

    <script>
        // --- å…¨åŸŸç‹€æ…‹èˆ‡åœ°åœ–ç‰©ä»¶ ---
        let routeState = {
            start: { name: "æœªè¨­å®š", element: null },
            end: { name: "æœªè¨­å®š", element: null }
        };
        let directionsService;
        let directionsRenderer;
        let currentRegionFilter = 'all'; // ç¯©é¸ç‹€æ…‹

        // --- 1. Google Maps åˆå§‹åŒ–å‡½å¼ ---
        function initMap() {
            const taiwanCenter = { lat: 23.7, lng: 120.9 }; 
            
            window.myMap = new google.maps.Map(document.getElementById("map-container"), {
                zoom: 8, center: taiwanCenter, mapId: "YOUR_MAP_ID", 
                disableDefaultUI: true, gestureHandling: "cooperative"
            });
            
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(window.myMap); 
            
            directionsRenderer.setDirections({ routes: [] });
            document.getElementById('start-point').textContent = routeState.start.name;
            document.getElementById('end-point').textContent = routeState.end.name;

            console.log("Google åœ°åœ–èˆ‡è·¯ç·šæœå‹™è¼‰å…¥å®Œæˆï¼");
        }

        // --- 2. AI æœå‹™æ ¸å¿ƒå‡½å¼ (æ¨¡æ“¬) ---

        async function fetchAttractionDetails(attractionName) {
            const apiKey = document.getElementById('ai-api-key').value;
            if (!apiKey) {
                return "éŒ¯èª¤ï¼šè«‹å…ˆè¼¸å…¥ AI æœå‹™é‡‘é‘°ï¼";
            }
            
            await new Promise(resolve => setTimeout(resolve, 1500)); 
            
            return `ã€${attractionName} æ·±åº¦ä»‹ç´¹ã€‘ç”± AI ç”Ÿæˆï¼š${attractionName} æ˜¯å°ç£éå¸¸è‘—åçš„æ™¯é»ã€‚å®ƒä¸åƒ…å…·æœ‰ç¨ç‰¹çš„æ­·å²æ„ç¾©ï¼Œä¹Ÿçµåˆäº†ç¾ä»£åŒ–çš„è¨­è¨ˆèˆ‡è‡ªç„¶æ™¯è§€ã€‚é€™è£¡æ˜¯éŠå®¢é«”é©—å°ç£æ–‡åŒ–å’Œç¾éº—æ™¯è‰²çš„å¿…å»ä¹‹åœ°ã€‚AI å»ºè­°æœ€ä½³åƒè¨ªæ™‚é–“ç‚ºé€±æœ«çš„ä¸‹åˆã€‚`;
        }

        async function generateImage(prompt) {
            const apiKey = document.getElementById('ai-api-key').value;
            if (!apiKey) {
                return "éŒ¯èª¤ï¼šè«‹å…ˆè¼¸å…¥ AI æœå‹™é‡‘é‘°ï¼";
            }

            await new Promise(resolve => setTimeout(resolve, 2000)); 

            const defaultImageMap = {
                "å°åŒ— 101": "https://fakeimg.pl/400x180/ADD8E6/000?text=AI+Generated+Taipei+101",
                "æ—¥æœˆæ½­": "https://fakeimg.pl/400x180/90EE90/000?text=AI+Generated+Sun+Moon+Lake",
                "é˜¿é‡Œå±±": "https://fakeimg.pl/400x180/F5DEB3/000?text=AI+Generated+Alishan",
                "å¤ªé­¯é–£": "https://fakeimg.pl/400x180/6A5ACD/FFF?text=AI+Generated+Taroko"
            };
            
            const imageName = prompt.split(' ')[0]; 
            return defaultImageMap[imageName] || "https://fakeimg.pl/400x180/F08080/000?text=AI+Image+Error";
        }
        
        // --- 3. è·¯ç·šè¦åŠƒå‡½å¼ ---
        function calculateRoute() {
            if (routeState.start.name === "æœªè¨­å®š" || routeState.end.name === "æœªè¨­å®š") {
                alert("è«‹å…ˆè¨­å®šå•Ÿç¨‹åœ°èˆ‡ç›®çš„åœ°ï¼");
                return;
            }
            if (routeState.start.name === routeState.end.name) {
                alert("èµ·ç¨‹åœ°èˆ‡ç›®çš„åœ°ä¸èƒ½ç›¸åŒï¼Œè«‹é‡æ–°é¸æ“‡ï¼");
                return;
            }
            
            const request = {
                origin: routeState.start.name,
                destination: routeState.end.name,
                travelMode: google.maps.TravelMode.DRIVING, 
                unitSystem: google.maps.UnitSystem.METRIC,
            };

            directionsService.route(request, (response, status) => {
                if (status === google.maps.DirectionsStatus.OK) {
                    directionsRenderer.setDirections(response);
                    
                    const route = response.routes[0];
                    const distance = route.legs[0].distance.text;
                    const duration = route.legs[0].duration.text;
                    
                    alert(`âœ… è·¯ç·šè¦åŠƒå®Œæˆï¼\nç¸½è·é›¢ï¼š${distance}\né è¨ˆæ™‚é–“ï¼š${duration}`);
                } else {
                    alert(`è·¯ç·šè¦åŠƒå¤±æ•—: ${status}. è«‹æª¢æŸ¥æ™¯é»åç¨±æ˜¯å¦æ­£ç¢ºã€‚`);
                    directionsRenderer.setDirections({ routes: [] });
                    console.error('Directions request failed due to ' + status);
                }
            });
        }
        
        // --- 4. æ™¯é»ç¯©é¸èˆ‡æœå°‹æ ¸å¿ƒå‡½å¼ ---
        function filterAttractions(regionFilter, searchQuery) {
            const cards = document.querySelectorAll('.attraction-cards .card');
            const normalizedQuery = searchQuery.toLowerCase().trim();

            cards.forEach(card => {
                const region = card.getAttribute('data-region');
                const name = card.getAttribute('data-name').toLowerCase();
                let shouldShow = true;

                if (regionFilter !== 'all' && region !== regionFilter) {
                    shouldShow = false;
                }

                if (normalizedQuery && !name.includes(normalizedQuery)) {
                    shouldShow = false;
                }

                card.style.display = shouldShow ? 'block' : 'none';
            });
        }
        
        // --- 5. äº‹ä»¶ç›£è½å™¨ç¶å®š (DOMContentLoaded) ---
        
        document.addEventListener('DOMContentLoaded', function() {
            // 1. åˆ†é¡æŒ‰éˆ•é»æ“Šäº‹ä»¶
            document.querySelector('.attraction-menu .menu-buttons').addEventListener('click', function(event) {
                const target = event.target;
                if (target.classList.contains('neumorphic-button') && target.hasAttribute('data-filter')) {
                    
                    document.querySelectorAll('.menu-buttons .neumorphic-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    target.classList.add('active');

                    currentRegionFilter = target.getAttribute('data-filter');
                    
                    const searchQuery = document.getElementById('attraction-search').value;
                    filterAttractions(currentRegionFilter, searchQuery);
                }
            });

            // 2. æœå°‹è¼¸å…¥æ¡†äº‹ä»¶ (å³æ™‚æœå°‹)
            document.getElementById('attraction-search').addEventListener('input', function(event) {
                const searchQuery = event.target.value;
                filterAttractions(currentRegionFilter, searchQuery);
            });

            // 3. è·¯ç·šè¦åŠƒæŒ‰éˆ•äº‹ä»¶
            document.querySelector('.calculate-route').addEventListener('click', calculateRoute);

        });
        
        // 4. æ™¯é»äº’å‹•é‚è¼¯ (ä¸»è¦é»æ“Šäº‹ä»¶)
        document.addEventListener('click', async function(event) {
            const target = event.target;
            
            if (target.classList.contains('neumorphic-button-small')) {
                const card = target.closest('.card');
                const attractionName = card.querySelector('h3').textContent;
                const type = target.getAttribute('data-type'); 
                
                if (type === 'details') {
                    // AI è©³æƒ…èˆ‡åœ–ç‰‡ç”Ÿæˆé‚è¼¯
                    const cardParagraph = card.querySelector('p');
                    const cardImagePlaceholder = card.querySelector('.card-image-placeholder');
                    
                    cardParagraph.textContent = "ğŸ” AI æ­£åœ¨ç”Ÿæˆæ™¯é»ä»‹ç´¹ä¸­ï¼Œè«‹ç¨å€™...";
                    const details = await fetchAttractionDetails(attractionName);
                    cardParagraph.textContent = details;
                    
                    cardImagePlaceholder.innerHTML = "ğŸ–¼ï¸ AI æ­£åœ¨ç”Ÿæˆåœ–ç‰‡ä¸­...";
                    const imagePrompt = `${attractionName}ï¼Œå°ç£ï¼Œå¤¢å¹»å¯«å¯¦é¢¨æ ¼`;
                    const imageUrl = await generateImage(imagePrompt);
                    
                    if (imageUrl.startsWith('éŒ¯èª¤')) {
                         cardImagePlaceholder.innerHTML = imageUrl;
                    } else {
                        cardImagePlaceholder.innerHTML = '';
                        const imgElement = document.createElement('img');
                        imgElement.src = imageUrl;
                        imgElement.alt = attractionName;
                        imgElement.style.width = '100%';
                        imgElement.style.height = '100%';
                        imgElement.style.borderRadius = 'inherit';
                        imgElement.style.objectFit = 'cover';
                        cardImagePlaceholder.appendChild(imgElement);
                    }
                    
                } else if (type === 'start' || type === 'end') {
                    // è·¯ç·šè¨­å®šé‚è¼¯
                    const key = type; 
                    
                    if (routeState[key].name === attractionName) {
                        // å–æ¶ˆè¨­å®š
                        routeState[key].name = "æœªè¨­å®š";
                        if (routeState[key].element) {
                            routeState[key].element.classList.remove('selected-start', 'selected-end');
                        }
                        routeState[key].element = null;
                        document.getElementById(`${key}-point`).textContent = routeState[key].name;
                        alert(`å·²å–æ¶ˆ ${attractionName} ä½œç‚º${key === 'start' ? 'å•Ÿç¨‹åœ°' : 'ç›®çš„åœ°'}ã€‚`);
                        return;
                    }

                    const oppositeKey = (key === 'start') ? 'end' : 'start';
                    if (routeState[oppositeKey].name === attractionName) {
                        alert(`ã€${attractionName}ã€‘å·²ç¶“è¨­å®šç‚º${oppositeKey === 'start' ? 'å•Ÿç¨‹åœ°' : 'ç›®çš„åœ°'}ï¼Œç„¡æ³•åŒæ™‚è¨­å®šï¼`);
                        return;
                    }

                    if (routeState[key].element) {
                        routeState[key].element.classList.remove('selected-start', 'selected-end');
                    }
                    
                    routeState[key].name = attractionName;
                    routeState[key].element = target;

                    target.classList.add(`selected-${key}`);
                    document.getElementById(`${key}-point`).textContent = attractionName;
                    
                    alert(`âœ… å·²è¨­å®š ${attractionName} ç‚º${key === 'start' ? 'å•Ÿç¨‹åœ°' : 'ç›®çš„åœ°'}ã€‚`);
                }
            }
        });
    </script>
</body>
</html>
