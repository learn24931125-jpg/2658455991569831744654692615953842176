<H1>æ™ºæ…§æ—…éŠå°è¦½</H1>
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å°ç£æ—…éŠå°è¦½ç³»çµ± - æ•´åˆæ¸¬è©¦ç‰ˆ</title>
    <style>
        :root {
            --primary: #2a9d8f;
            --dark: #264653;
            --light: #f4f1de;
            --accent: #e9c46a;
        }

        body {
            font-family: "Microsoft JhengHei", sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: var(--light);
        }

        /* æ¨™é¡Œå€ */
        header {
            background: var(--dark);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* å´é‚Šè¨­å®šæ¬„ */
        .sidebar {
            width: 320px;
            background: white;
            padding: 20px;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        input, select, button {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 14px;
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        button:hover { background: #21867a; }

        .info-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        /* ä¸»å…§å®¹å€ */
        .content {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* åœ°åœ–ä½”ä½ç¬¦ */
        #map-area {
            height: 250px;
            background: #e0e0e0;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            border: 2px dashed #ccc;
        }

        /* æ™¯é»å¡ç‰‡ç¶²æ ¼ */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: 0.3s;
        }

        .card:hover { transform: translateY(-5px); }

        .card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: #eee;
        }

        .card-content { padding: 15px; }
        .card-content h4 { margin: 0 0 10px 0; color: var(--dark); }
        .card-content p { font-size: 14px; color: #666; line-height: 1.5; }

        .loading-spinner {
            text-align: center;
            padding: 50px;
            display: none;
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸ‡¹ğŸ‡¼ AI æ™ºæ…§æ—…éŠå°è¦½ç³»çµ±</h1>
</header>

<main>
    <aside class="sidebar">
        <div class="input-group">
            <label><strong>1. API è¨­å®š</strong></label>
            <input type="password" id="api-key" placeholder="è²¼ä¸Šæ‚¨çš„ Gemini API Key">
        </div>

        <div class="input-group">
            <label><strong>2. é¸æ“‡ç›®çš„åœ°</strong></label>
            <select id="city-select">
                <option value="å°åŒ—" data-lat="25.03" data-lon="121.56">å°åŒ—å¸‚</option>
                <option value="å°ä¸­" data-lat="24.14" data-lon="120.67">å°ä¸­å¸‚</option>
                <option value="å°å—" data-lat="22.99" data-lon="120.21">å°å—å¸‚</option>
                <option value="é«˜é›„" data-lat="22.61" data-lon="120.31">é«˜é›„å¸‚</option>
                <option value="èŠ±è“®" data-lat="23.97" data-lon="121.60">èŠ±è“®ç¸£</option>
                <option value="å®œè˜­" data-lat="24.75" data-lon="121.75">å®œè˜­ç¸£</option>
            </select>
        </div>

        <button onclick="startGuide()">é–‹å§‹ AI å°è¦½è¦åŠƒ</button>

        <div class="info-box">
            <div id="weather-info">ğŸŒ¤ï¸ å¤©æ°£è³‡è¨Šè¼‰å…¥ä¸­...</div>
            <hr>
            <div id="ai-summary">è«‹é»æ“ŠæŒ‰éˆ•ï¼ŒAI å°‡ç‚ºæ‚¨æä¾›å»ºè­°ã€‚</div>
        </div>
    </aside>

    <section class="content">
        <div id="map-area">ğŸ“ ç•¶å‰åŸå¸‚ç¶“ç·¯åº¦ï¼š<span id="coords-display">ç­‰å¾…é¸æ“‡...</span></div>
        
        <h3>âœ¨ AI æ¨è–¦æ™¯é»</h3>
        <div id="loading" class="loading-spinner">â³ AI æ­£åœ¨æ€è€ƒä¸­ï¼Œè«‹ç¨å€™...</div>
        <div class="cards-grid" id="cards-grid">
            </div>
    </section>
</main>

<script>
    const GEMINI_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent";

    async function startGuide() {
        const apiKey = document.getElementById('api-key').value;
        const citySelect = document.getElementById('city-select');
        const selected = citySelect.options[citySelect.selectedIndex];
        
        const cityName = selected.value;
        const lat = selected.dataset.lat;
        const lon = selected.dataset.lon;

        if (!apiKey) {
            alert("è«‹å…ˆè¼¸å…¥æ‚¨çš„ Gemini API Keyï¼");
            return;
        }

        // é‡ç½®ä»‹é¢
        document.getElementById('coords-display').innerText = `${lat}, ${lon}`;
        document.getElementById('loading').style.display = "block";
        document.getElementById('cards-grid').innerHTML = "";

        // 1. æŠ“å–å¤©æ°£ (Open-Meteo)
        fetchWeather(cityName, lat, lon);

        // 2. æŠ“å– AI å»ºè­° (Gemini)
        fetchAIData(apiKey, cityName);
    }

    async function fetchWeather(name, lat, lon) {
        try {
            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
            const data = await res.json();
            const temp = data.current_weather.temperature;
            const code = data.current_weather.weathercode;
            const weatherDesc = code <= 3 ? "æ™´æœ—" : (code >= 61 ? "æœ‰é›¨" : "å¤šé›²");
            document.getElementById('weather-info').innerHTML = `<strong>${name} ç•¶å‰å¤©æ°£</strong><br>${weatherDesc} ${temp}Â°C`;
        } catch (e) {
            document.getElementById('weather-info').innerText = "å¤©æ°£ç²å–å¤±æ•—";
        }
    }

    async function fetchAIData(key, cityName) {
        const prompt = `ä½ æ˜¯ä¸€ä½å°ç£æ—…éŠå°ˆå®¶ã€‚è«‹é‡å°ã€Œ${cityName}ã€æä¾›æ—…éŠå»ºè­°ã€‚è«‹å›å‚³ JSON æ ¼å¼å¦‚ä¸‹ï¼š{"summary": "å»ºè­°å…§å®¹", "attractions": [{"title": "åç¨±", "desc": "æè¿°", "keyword": "è‹±æ–‡é—œéµå­—"}]}`;

        try {
            const response = await fetch(`${GEMINI_URL}?key=${key}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { response_mime_type: "application/json" }
                })
            });

            const data = await response.json();
            const result = JSON.parse(data.candidates[0].content.parts[0].text);

            // æ›´æ–° UI
            document.getElementById('ai-summary').innerText = result.summary;
            document.getElementById('loading').style.display = "none";
            
            result.attractions.forEach(attr => {
                const card = document.createElement('div');
                card.className = 'card';
                // ä½¿ç”¨ LoremFlickr æ ¹æ“šé—œéµå­—æŠ“å–å°ç£ç›¸é—œåœ–ç‰‡
                const imgUrl = `https://loremflickr.com/400/300/${attr.keyword},taiwan/all`;
                
                card.innerHTML = `
                    <img src="${imgUrl}" alt="${attr.title}">
                    <div class="card-content">
                        <h4>${attr.title}</h4>
                        <p>${attr.desc}</p>
                    </div>
                `;
                document.getElementById('cards-grid').appendChild(card);
            });

        } catch (error) {
            console.error(error);
            document.getElementById('loading').innerText = "âŒ ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ API Key æˆ–ç¶²è·¯ã€‚";
        }
    }
</script>

</body>
</html>
